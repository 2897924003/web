import{_ as J,z as F,r as f,o as L,B as q,C as U,D as d,Q as W,E as C,j as o,G as k,H as v,O as N,J as O,U as A,N as K,I as X,L as Y,V as Z}from"./index-CeeqmRIO.js";import{Q as D}from"./QInput-C0kg-8gv.js";import{Q as $}from"./QTable-C3wxdmtf.js";import{Q as ee,a as T,b as te}from"./QCardActions-DUu7N6pJ.js";import{Q as ae}from"./QDialog-ClFP_LGy.js";import{Q as oe}from"./QPage-BHVqYzDk.js";import{C as ne}from"./ClosePopup-C5PDsx4j.js";import"./QSelect-aA8iUZEr.js";import"./QCheckbox-DYH2lDU-.js";function z(w){setTimeout(()=>{window.URL.revokeObjectURL(w.href)},1e4),w.remove()}function M(w,n,r={}){const{mimeType:t,byteOrderMark:b,encoding:g}=typeof r=="string"?{mimeType:r}:r,e=g!==void 0?new TextEncoder(g).encode([n]):n,h=b!==void 0?[b,e]:[e],y=new Blob(h,{type:t||"application/octet-stream"}),i=document.createElement("a");i.href=window.URL.createObjectURL(y),i.setAttribute("download",w),typeof i.download>"u"&&i.setAttribute("target","_blank"),i.classList.add("hidden"),i.style.position="fixed",document.body.appendChild(i);try{return i.click(),z(i),!0}catch(_){return z(i),_}}const le={__name:"StudentInfoPage",setup(w,{expose:n}){n();const r=F(),t=[{name:"userId",required:!0,label:"ID",field:l=>l.id,format:l=>`${l}`,align:"center",sortable:!1},{name:"dormitory",required:!0,label:"寝室",field:"dormitory",align:"center",sortable:!1},{name:"name",required:!0,label:"姓名",field:"name",align:"center",sortable:!1},{name:"phone",required:!1,label:"电话",field:"phone",align:"center",sortable:!1}],b=f([]),g=f([]),e=f([]),h=f(""),y=f(!1),i=f(!1),_=f(!1),S=f({id:null,dormitory:null,name:null,phone:null}),u=f({sortBy:"desc",descending:!1,page:1,rowsPerPage:12,rowsNumber:0}),Q=(l,c,s)=>{let a=c!==void 0?c(l,s):l;return a=a==null?"":String(a),a=a.split('"').join('""'),a.indexOf(",")>-1||a.indexOf(`
`)>-1||a.indexOf('"')>-1?`"${a}"`:a},G=()=>{const l=[t.map(s=>Q(s.label))].concat(b.value.map(s=>t.map(a=>Q(typeof a.field=="function"?a.field(s):s[a.field===void 0?a.name:a.field],a.format,s)).join(","))).join(`\r
`);M("学生信息.csv",l,"text/csv")!==!0&&this.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},R=async()=>{try{const l=await C.get("/api/class/student_infos",{headers:{Authorization:sessionStorage.getItem("jwt")}});return g.value=l.data.records,u.value.rowsNumber=g.value.length,g.value}catch(l){return console.error("Error fetching data:",l),[]}},x=async l=>{const{page:c,rowsPerPage:s,sortBy:a,descending:P}=l.pagination,j=l.filter;y.value=!0;const H=s===0?u.value.rowsNumber:s,E=(c-1)*s;await R();let V=g.value.slice();if(j&&(V=V.filter(I=>I.id.includes(j))),a){const I=a==="desc"?P?(p,m)=>p.id>m.id?-1:p.id<m.id?1:0:(p,m)=>p.id>m.id?1:p.id<m.id?-1:0:P?(p,m)=>parseFloat(m[a])-parseFloat(p[a]):(p,m)=>parseFloat(p[a])-parseFloat(m[a]);V.sort(I)}b.value=V.slice(E,E+H),y.value=!1,u.value.page=c,u.value.rowsPerPage=s,u.value.sortBy=a,u.value.descending=P};L(()=>{x({pagination:u.value,filter:void 0})});const B={$q:r,columns:t,rows:b,originalRows:g,selected:e,filter:h,loading:y,rowDialog:i,isEditing:_,rowDetails:S,pagination:u,wrapCsvValue:Q,exportTable:G,fetchFromServer:R,getInfos:x,getSelectedString:()=>e.value.length===0?"":`${e.value.length} record${e.value.length>1?"s":""} selected of ${b.value.length}`,openRowOfStudentInfoDialog:(l,c,s)=>{_.value=!0,S.value={...c},i.value=!0},openAddStudentDialog:()=>{_.value=!1,S.value={id:null,dormitory:null,name:null,phone:null},i.value=!0},updateStudentInfo:async()=>{try{(await C.post("https://test.opensun.asia/api/class/update_student_info",S.value)).status===200?(await x({pagination:u.value,filter:void 0}),i.value=!1,r.notify({message:"更新信息成功",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})):r.notify({message:"更新信息失败",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})}catch{r.notify({message:"更新表失败",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})}},addStudent:async()=>{try{(await C.post("https://test.opensun.asia/api/class/add_student",S.value)).status===200&&(await x({pagination:u.value,filter:void 0}),i.value=!1,r.notify({message:"添加成功",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}))}catch{r.notify({message:"添加失败",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})}},deleteStudent:async()=>{try{(await C.post("https://test.opensun.asia/api/class/delete_student",e.value.map(c=>c.id))).status===200&&(e.value=[],await x({pagination:u.value,filter:void 0}),i.value=!1,r.notify({message:"删除成功",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"}))}catch{r.notify({message:"删除失败",position:"top",avatar:"https://cdn.quasar.dev/img/boy-avatar.png"})}},onMounted:L,ref:f,get axios(){return C},get exportFile(){return M},get useQuasar(){return F}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}},ie={class:"q-pa-md",style:{width:"100%",height:"100%"}},re={class:"row q-gutter-lg"},se={class:"full-width row flex-center text-accent q-gutter-sm"},de={class:"text-h6"};function ue(w,n,r,t,b,g){return q(),U(W,{class:"row justify-center"},{default:d(()=>[o(oe,{class:"bg-accent"},{default:d(()=>[k("div",ie,[o($,{grid:"","card-class":"bg-amber-5 text-purple",color:"red",title:"班级学生信息",rows:t.rows,columns:t.columns,"row-key":"id",selection:"multiple","selected-rows-label":t.getSelectedString,selected:t.selected,"onUpdate:selected":n[1]||(n[1]=e=>t.selected=e),loading:t.loading,filter:t.filter,pagination:t.pagination,"onUpdate:pagination":n[2]||(n[2]=e=>t.pagination=e),onRequest:t.getInfos,"no-data-label":"没有指定数据","no-results-label":"没有匹配数据",onRowClick:t.openRowOfStudentInfoDialog},{pagination:d(e=>[e.pagesNumber>2?(q(),U(v,{key:0,icon:"first_page",color:"grey-8",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage},null,8,["disable","onClick"])):N("",!0),o(v,{icon:"chevron_left",color:"grey-8",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage},null,8,["disable","onClick"]),o(v,{icon:"chevron_right",color:"grey-8",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage},null,8,["disable","onClick"]),e.pagesNumber>2?(q(),U(v,{key:1,icon:"last_page",color:"grey-8",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.lastPage},null,8,["disable","onClick"])):N("",!0)]),top:d(()=>[k("div",re,[o(v,{color:"primary",label:"新增学生",onClick:t.openAddStudentDialog}),o(v,{color:"primary",label:"删除学生",onClick:t.deleteStudent}),o(v,{color:"primary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:t.exportTable}),o(D,{borderless:"",dense:"",debounce:"800",modelValue:t.filter,"onUpdate:modelValue":n[0]||(n[0]=e=>t.filter=e),placeholder:"搜索..."},{append:d(()=>[o(O,{name:"search"})]),_:1},8,["modelValue"])])]),"no-data":d(({icon:e,message:h,filter:y})=>[k("div",se,[o(O,{size:"2em",name:"sentiment_dissatisfied"}),k("span",null," Well this is sad... "+A(h),1),o(O,{size:"2em",name:y?"filter_b_and_w":e},null,8,["name"])])]),_:1},8,["rows","selected","loading","filter","pagination"])]),o(ae,{modelValue:t.rowDialog,"onUpdate:modelValue":n[8]||(n[8]=e=>t.rowDialog=e)},{default:d(()=>[o(ee,null,{default:d(()=>[o(T,null,{default:d(()=>[k("div",de,A(t.isEditing?"修改学生信息":"添加学生"),1)]),_:1}),o(K),o(T,null,{default:d(()=>[o(D,{clearable:"",readonly:t.isEditing,modelValue:t.rowDetails.id,"onUpdate:modelValue":n[3]||(n[3]=e=>t.rowDetails.id=e),label:"id"},null,8,["readonly","modelValue"]),o(D,{clearable:"",modelValue:t.rowDetails.dormitory,"onUpdate:modelValue":n[4]||(n[4]=e=>t.rowDetails.dormitory=e),label:"寝室号"},null,8,["modelValue"]),o(D,{clearable:"",modelValue:t.rowDetails.name,"onUpdate:modelValue":n[5]||(n[5]=e=>t.rowDetails.name=e),label:"姓名"},null,8,["modelValue"]),o(D,{clearable:"",maxlength:"11",modelValue:t.rowDetails.phone,"onUpdate:modelValue":n[6]||(n[6]=e=>t.rowDetails.phone=e),label:"电话",mask:"",rules:[e=>/^(?:1[3-9])\d{9}$/.test(e)||"请输入有效的中国手机号"]},{prepend:d(()=>[o(X,null,{default:d(()=>[o(Y,{fit:"cover",src:"/icons/china1.png"})]),_:1})]),_:1},8,["modelValue","rules"])]),_:1}),o(te,{align:"right"},{default:d(()=>[Z(o(v,{flat:"",label:"返回",color:"primary"},null,512),[[ne]]),o(v,{flat:"",label:"确认",color:"primary",onClick:n[7]||(n[7]=e=>t.isEditing?t.updateStudentInfo():t.addStudent())})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const De=J(le,[["render",ue],["__scopeId","data-v-0254b731"],["__file","StudentInfoPage.vue"]]);export{De as default};
